<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Repository File Manager</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --bg-hover: #2a2d2e;
      --border-color: #3e3e42;
      --text-primary: #cccccc;
      --text-secondary: #858585;
      --text-highlight: #4ec9b0;
      --accent: #007acc;
      --accent-hover: #005a9e;
      --folder-color: #dcb67a;
      --file-color: #cccccc;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
      flex-direction: column;
    }

    header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .header-info {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .breadcrumb {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 8px 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      min-height: 36px;
    }

    .breadcrumb-item {
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 3px;
      transition: background 0.2s;
    }

    .breadcrumb-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .breadcrumb-separator {
      color: var(--text-secondary);
    }

    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 350px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .file-list {
      flex: 1;
      overflow-y: auto;
      overflow-x: auto;
    }

    .file-item {
      display: flex;
      align-items: center;
      padding: 6px 12px;
      cursor: pointer;
      border-bottom: 1px solid transparent;
      transition: background 0.15s;
      user-select: none;
      font-size: 13px;
    }

    .file-item:hover {
      background: var(--bg-hover);
    }

    .file-item.selected {
      background: var(--bg-tertiary);
      border-left: 2px solid var(--accent);
    }

    .file-item.directory {
      font-weight: 500;
    }

    .file-icon {
      margin-right: 8px;
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    .file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-size {
      font-size: 11px;
      color: var(--text-secondary);
      margin-left: 12px;
    }

    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .content-title {
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .content-meta {
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      gap: 15px;
    }

    .content-body {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }

    pre {
      margin: 0;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre;
      overflow-x: auto;
    }

    .line-numbers {
      display: flex;
    }

    .line-numbers-rows {
      border-right: 1px solid var(--border-color);
      padding-right: 12px;
      margin-right: 12px;
      color: var(--text-secondary);
      text-align: right;
      user-select: none;
      min-width: 40px;
    }

    .line-numbers-rows span {
      display: block;
      line-height: 1.6;
    }

    .code-content {
      flex: 1;
    }

    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .error-message {
      background: #5a1d1d;
      color: #f48771;
      padding: 20px;
      border-radius: 4px;
      margin: 20px;
      font-size: 13px;
    }

    .info-message {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      padding: 20px;
      border-radius: 4px;
      font-size: 13px;
      text-align: center;
    }

    .directory-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      padding: 20px;
    }

    .directory-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .directory-card:hover {
      background: var(--bg-tertiary);
      border-color: var(--accent);
    }

    .directory-card-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .directory-card-name {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      word-break: break-word;
    }

    .directory-card-info {
      font-size: 11px;
      color: var(--text-secondary);
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg-tertiary);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #3e3e42;
    }

    /* Code syntax highlighting */
    .keyword { color: #569cd6; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; }
    .function { color: #dcdcaa; }
    .number { color: #b5cea8; }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }

      .main-content {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="loading">Loading repository...</div>

  <script>
    class FileManager {
      constructor() {
        this.data = null;
        this.currentPath = [];
        this.selectedFile = null;
        this.init();
      }

      async init() {
        try {
          const response = await fetch('index.json');
          if (!response.ok) throw new Error('Failed to load repository data');
          this.data = await response.json();
          this.render();
        } catch (error) {
          this.renderError(error);
        }
      }

      getCurrentDirectory() {
        let current = { children: this.data.structure };
        for (const segment of this.currentPath) {
          current = current.children.find(item => item.name === segment);
          if (!current) return { children: [] };
        }
        return current;
      }

      navigateTo(path) {
        this.currentPath = path;
        this.selectedFile = null;
        this.render();
      }

      openItem(item) {
        if (item.type === 'directory') {
          this.currentPath.push(item.name);
          this.selectedFile = null;
        } else {
          this.selectedFile = item;
        }
        this.render();
      }

      formatSize(bytes) {
        if (!bytes) return '0 B';
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / 1024 / 1024).toFixed(2) + ' MB';
      }

      formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
      }

      getFileIcon(item) {
        if (item.type === 'directory') return 'ðŸ“';
        
        const ext = item.name.split('.').pop().toLowerCase();
        const iconMap = {
          'js': 'ðŸ“œ', 'jsx': 'âš›ï¸', 'ts': 'ðŸ“˜', 'tsx': 'âš›ï¸',
          'py': 'ðŸ', 'java': 'â˜•', 'c': 'ðŸ”§', 'cpp': 'ðŸ”§', 'cs': 'ðŸŽ¯',
          'html': 'ðŸŒ', 'css': 'ðŸŽ¨', 'scss': 'ðŸŽ¨',
          'json': 'ðŸ“‹', 'xml': 'ðŸ“‹', 'yml': 'âš™ï¸', 'yaml': 'âš™ï¸',
          'md': 'ðŸ“', 'txt': 'ðŸ“„',
          'png': 'ðŸ–¼ï¸', 'jpg': 'ðŸ–¼ï¸', 'gif': 'ðŸ–¼ï¸', 'svg': 'ðŸ–¼ï¸',
          'zip': 'ðŸ“¦', 'tar': 'ðŸ“¦', 'gz': 'ðŸ“¦',
          'pdf': 'ðŸ“•', 'doc': 'ðŸ“˜', 'xls': 'ðŸ“—',
        };
        
        return iconMap[ext] || 'ðŸ“„';
      }

      renderBreadcrumb() {
        const items = ['Root', ...this.currentPath];
        return items.map((item, index) => {
          const isLast = index === items.length - 1;
          const path = this.currentPath.slice(0, index);
          
          return `
            ${index > 0 ? '<span class="breadcrumb-separator">/</span>' : ''}
            <span class="breadcrumb-item ${isLast ? 'active' : ''}" 
                  onclick="app.navigateTo(${JSON.stringify(path).replace(/"/g, '&quot;')})">
              ${item}
            </span>
          `;
        }).join('');
      }

      renderFileList() {
        const current = this.getCurrentDirectory();
        const items = current.children || [];

        if (items.length === 0) {
          return '<div class="empty-state">Empty directory</div>';
        }

        return items.map(item => `
          <div class="file-item ${item.type} ${this.selectedFile?.path === item.path ? 'selected' : ''}"
               onclick="app.openItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
            <span class="file-icon">${this.getFileIcon(item)}</span>
            <span class="file-name">${item.name}</span>
            ${item.size ? `<span class="file-size">${this.formatSize(item.size)}</span>` : ''}
          </div>
        `).join('');
      }

      renderContent() {
        if (!this.selectedFile) {
          const current = this.getCurrentDirectory();
          if (this.currentPath.length === 0) {
            return this.renderDirectoryGrid(current.children || []);
          }
          return '<div class="empty-state">Select a file to view its contents</div>';
        }

        const file = this.selectedFile;

        if (file.error) {
          return `<div class="error-message">Error: ${file.error}</div>`;
        }

        if (file.isBinary) {
          return `
            <div class="info-message">
              <p>ðŸ“¦ Binary file (${this.formatSize(file.size)})</p>
              <p>Preview not available</p>
            </div>
          `;
        }

        if (!file.content) {
          return '<div class="info-message">No preview available</div>';
        }

        return this.renderCodeWithLineNumbers(file.content);
      }

      renderCodeWithLineNumbers(content) {
        const lines = content.split('\n');
        const lineNumbers = lines.map((_, i) => `<span>${i + 1}</span>`).join('');
        const escapedContent = this.escapeHtml(content);

        return `
          <div class="line-numbers">
            <div class="line-numbers-rows">${lineNumbers}</div>
            <pre class="code-content"><code>${escapedContent}</code></pre>
          </div>
        `;
      }

      renderDirectoryGrid(items) {
        if (items.length === 0) {
          return '<div class="empty-state">Empty directory</div>';
        }

        return `
          <div class="directory-view">
            ${items.map(item => `
              <div class="directory-card" onclick="app.openItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                <div class="directory-card-icon">${this.getFileIcon(item)}</div>
                <div class="directory-card-name">${item.name}</div>
                <div class="directory-card-info">
                  ${item.type === 'directory' 
                    ? `${item.children?.length || 0} items` 
                    : this.formatSize(item.size)}
                </div>
              </div>
            `).join('')}
          </div>
        `;
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      render() {
        const app = document.getElementById('app');
        
        app.innerHTML = `
          <div class="container">
            <header>
              <div class="header-title">
                ðŸ“‚ ${this.data.repository || 'Repository'} File Manager
              </div>
              <div class="header-info">
                Last updated: ${new Date(this.data.generated).toLocaleString()}
              </div>
            </header>

            <div class="breadcrumb">
              ${this.renderBreadcrumb()}
            </div>

            <div class="main-content">
              <div class="sidebar">
                <div class="file-list">
                  ${this.renderFileList()}
                </div>
              </div>

              <div class="content-area">
                ${this.selectedFile ? `
                  <div class="content-header">
                    <div class="content-title">
                      <span>${this.getFileIcon(this.selectedFile)}</span>
                      <span>${this.selectedFile.name}</span>
                    </div>
                    <div class="content-meta">
                      ${this.selectedFile.size ? `<span>${this.formatSize(this.selectedFile.size)}</span>` : ''}
                      ${this.selectedFile.lines ? `<span>${this.selectedFile.lines} lines</span>` : ''}
                      ${this.selectedFile.fileType ? `<span>${this.selectedFile.fileType}</span>` : ''}
                    </div>
                  </div>
                ` : ''}
                <div class="content-body">
                  ${this.renderContent()}
                </div>
              </div>
            </div>
          </div>
        `;
      }

      renderError(error) {
        const app = document.getElementById('app');
        app.innerHTML = `
          <div class="loading">
            <div class="error-message">
              <strong>Error loading repository:</strong><br>
              ${error.message}
            </div>
          </div>
        `;
      }
    }

    // Initialize the app
    const app = new FileManager();
  </script>
</body>
</html>