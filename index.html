<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #252526;
            --bg-tertiary: #2d2d30;
            --bg-hover: #2a2d2e;
            --border-color: #3e3e42;
            --text-primary: #cccccc;
            --text-secondary: #858585;
            --accent: #007acc;
            --accent-hover: #005a9e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: var(--bg-secondary);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 16px;
            font-weight: 500;
        }

        .header-info {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .breadcrumb {
            background: var(--bg-secondary);
            padding: 8px 20px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .breadcrumb-item {
            cursor: pointer;
            color: var(--text-primary);
        }

        .breadcrumb-item:hover {
            color: var(--accent);
        }

        .breadcrumb-separator {
            color: var(--text-secondary);
            user-select: none;
        }

        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .file-list {
            padding: 8px 0;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 6px 20px;
            cursor: pointer;
            user-select: none;
            font-size: 13px;
            white-space: nowrap;
        }

        .file-item:hover {
            background: var(--bg-hover);
        }

        .file-item.selected {
            background: var(--bg-tertiary);
        }

        .file-item.directory {
            font-weight: 500;
        }

        .file-icon {
            margin-right: 8px;
            width: 16px;
            text-align: center;
            flex-shrink: 0;
        }

        .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-size {
            margin-left: 10px;
            font-size: 11px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .nested {
            padding-left: 20px;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            background: var(--bg-secondary);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .content-body {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            font-size: 14px;
        }

        pre {
            margin: 0;
            background: var(--bg-secondary) !important;
            border-radius: 6px;
            overflow-x: auto;
        }

        pre code {
            display: block;
            padding: 20px !important;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .error-message {
            background: #5a1e1e;
            border: 1px solid #8b3434;
            border-radius: 6px;
            padding: 20px;
            color: #f48771;
        }

        .error-message h3 {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .error-message p {
            font-size: 13px;
            color: #cccccc;
        }

        .directory-view {
            background: var(--bg-secondary);
            border-radius: 6px;
            padding: 20px;
        }

        .directory-view h3 {
            font-size: 14px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .directory-item {
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
        }

        .directory-item:hover {
            background: var(--bg-tertiary);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3e3e42;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: -300px;
                height: 100%;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .mobile-toggle {
                display: block;
                background: var(--accent);
                border: none;
                color: white;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            }
        }

        .mobile-toggle {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="loading">Loading repository index...</div>
    </div>

    <script>
        class FileManager {
            constructor() {
                this.data = null;
                this.currentPath = [];
                this.selectedFile = null;
                this.init();
            }

            async init() {
                try {
                    const response = await fetch('index.json');
                    this.data = await response.json();
                    this.render();
                } catch (error) {
                    document.getElementById('app').innerHTML = `
                        <div class="error-message">
                            <h3>Failed to load repository index</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }

            getCurrentDirectory() {
                let current = { children: this.data.tree };
                for (const segment of this.currentPath) {
                    current = current.children.find(item => item.name === segment);
                    if (!current) return null;
                }
                return current;
            }

            navigateTo(path) {
                this.currentPath = path;
                this.selectedFile = null;
                this.render();
            }

            selectFile(file) {
                this.selectedFile = file;
                this.render();
            }

            formatSize(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleString();
            }

            getFileIcon(item) {
                if (item.type === 'directory') {
                    return 'üìÅ';
                }
                const ext = item.name.split('.').pop().toLowerCase();
                const iconMap = {
                    'js': 'üìú',
                    'json': 'üìã',
                    'html': 'üåê',
                    'css': 'üé®',
                    'md': 'üìù',
                    'py': 'üêç',
                    'java': '‚òï',
                    'png': 'üñºÔ∏è',
                    'jpg': 'üñºÔ∏è',
                    'gif': 'üñºÔ∏è',
                    'pdf': 'üìÑ',
                    'zip': 'üì¶',
                };
                return iconMap[ext] || 'üìÑ';
            }

            renderBreadcrumb() {
                const parts = [
                    `<span class="breadcrumb-item" onclick="app.navigateTo([])">üè† Root</span>`
                ];
                
                let path = [];
                for (const segment of this.currentPath) {
                    path.push(segment);
                    const pathCopy = [...path];
                    parts.push(`<span class="breadcrumb-separator">/</span>`);
                    parts.push(`<span class="breadcrumb-item" onclick="app.navigateTo(${JSON.stringify(pathCopy).replace(/"/g, '&quot;')})">${segment}</span>`);
                }
                
                return `<div class="breadcrumb">${parts.join('')}</div>`;
            }

            renderFileTree(items, level = 0) {
                if (!items || items.length === 0) return '';
                
                return items.map(item => {
                    const icon = this.getFileIcon(item);
                    const isSelected = this.selectedFile && this.selectedFile.path === item.path;
                    
                    if (item.type === 'directory') {
                        const pathArray = item.path.split('/');
                        return `
                            <div class="file-item directory ${isSelected ? 'selected' : ''}" 
                                 onclick="app.navigateTo(${JSON.stringify(pathArray).replace(/"/g, '&quot;')})"
                                 style="padding-left: ${20 + level * 20}px">
                                <span class="file-icon">${icon}</span>
                                <span class="file-name">${item.name}</span>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="file-item ${isSelected ? 'selected' : ''}" 
                                 onclick='app.selectFile(${JSON.stringify(item).replace(/'/g, "&#39;")})'
                                 style="padding-left: ${20 + level * 20}px">
                                <span class="file-icon">${icon}</span>
                                <span class="file-name">${item.name}</span>
                                <span class="file-size">${this.formatSize(item.size)}</span>
                            </div>
                        `;
                    }
                }).join('');
            }

            renderCurrentDirectory() {
                const current = this.getCurrentDirectory();
                if (!current || !current.children) {
                    return this.renderFileTree(this.data.tree);
                }
                return this.renderFileTree(current.children);
            }

            renderContent() {
                if (!this.selectedFile) {
                    const current = this.getCurrentDirectory();
                    if (current && current.children) {
                        const dirs = current.children.filter(i => i.type === 'directory');
                        const files = current.children.filter(i => i.type === 'file');
                        
                        return `
                            <div class="directory-view">
                                <h3>üìÅ ${this.currentPath[this.currentPath.length - 1] || 'Root Directory'}</h3>
                                ${dirs.length > 0 ? `
                                    <div style="margin-bottom: 20px;">
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Directories (${dirs.length})</div>
                                        ${dirs.map(dir => {
                                            const pathArray = dir.path.split('/');
                                            return `
                                                <div class="directory-item" onclick="app.navigateTo(${JSON.stringify(pathArray).replace(/"/g, '&quot;')})">
                                                    <span class="file-icon">üìÅ</span>
                                                    <span>${dir.name}</span>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                ` : ''}
                                ${files.length > 0 ? `
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Files (${files.length})</div>
                                        ${files.map(file => `
                                            <div class="directory-item" onclick='app.selectFile(${JSON.stringify(file).replace(/'/g, "&#39;")})'>
                                                <span class="file-icon">${this.getFileIcon(file)}</span>
                                                <span>${file.name}</span>
                                                <span style="margin-left: auto; font-size: 11px; color: var(--text-secondary);">${this.formatSize(file.size)}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    return '<div class="empty-state">Select a file to view its contents</div>';
                }

                if (this.selectedFile.error) {
                    return `
                        <div class="error-message">
                            <h3>${this.selectedFile.error}</h3>
                            <p>${this.selectedFile.message}</p>
                        </div>
                    `;
                }

                const content = this.selectedFile.content || '';
                const language = this.selectedFile.language || 'text';
                
                return `<pre><code class="language-${language}">${this.escapeHtml(content)}</code></pre>`;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            render() {
                const app = document.getElementById('app');
                
                app.innerHTML = `
                    <div class="header">
                        <h1>üìÇ ${this.data.repository}</h1>
                        <div class="header-info">
                            Branch: ${this.data.branch} | Updated: ${this.formatDate(this.data.generated)}
                        </div>
                    </div>
                    ${this.renderBreadcrumb()}
                    <div class="main">
                        <div class="sidebar">
                            <div class="file-list">
                                ${this.renderCurrentDirectory()}
                            </div>
                        </div>
                        <div class="content">
                            ${this.selectedFile ? `
                                <div class="content-header">
                                    <span>${this.selectedFile.name}</span>
                                    <span class="file-meta">
                                        ${this.formatSize(this.selectedFile.size)} | 
                                        Modified: ${this.formatDate(this.selectedFile.modified)}
                                    </span>
                                </div>
                            ` : ''}
                            <div class="content-body">
                                ${this.renderContent()}
                            </div>
                        </div>
                    </div>
                `;

                // Apply syntax highlighting
                if (this.selectedFile && this.selectedFile.content) {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }
            }
        }

        const app = new FileManager();
    </script>
</body>
</html>